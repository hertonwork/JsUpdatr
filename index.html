<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JsUpdatr Example</title>
    <meta name="description" content="JsUpdatr observer example page">
    <link rel="prefetch" href="https://unpkg.com/open-props" />
    <link rel="prefetch" href="https://unpkg.com/open-props/normalize.min.css" />
    <link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hertonwork/updatr@v1.0.0/src/index.min.js" />

    <style>
        @import "https://unpkg.com/open-props";
        @import "https://unpkg.com/open-props/normalize.min.css";

        main {
            max-width: 1200px;
            margin: auto;
            padding: 6vh 3vw;
        }

        h3 {
            padding: var(--size-3) 0;
        }

        label {
            display: block;
            padding: var(--size-3) 0;
        }

        dd::before {
            content: 'data.' attr(data-watch) ' = ';
        }

        /* responsive without media queries  */
        .full-section {
            margin: 3vh 0;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            grid-gap: 2vh;
        }
    </style>
    <!-- JsUpdatr State -->
    <script type="text/javascript">
        document.state = {
            name: '',
            showName: false,
            text: 'fruit salad',
            favorites: 'ü•• üçì üçç',
            number: 22,
            largest: 23,
            smallest: 11,
        }
    </script>
</head>

<body>
    <main>
        <h2>JsUpdatr</h2>
        <section class="full-section">
            <article>
                <h3>Data Models</h3>
                <p>
                    <label for="data_name">Some name</label>
                    <input id="data_name" type="text" name="data_name" data-model="name" value="">
                </p>
                <p>
                    <label for="data_text">Some text</label>
                    <input id="data_text" type="text" name="data_text" data-model="text" value="">
                </p>
                <p>
                    <label for="data_text">Number limited by the min max fields</label>
                    <input id="data_number" type="number" name="data_number"
                        data-watch-attributes="smallest:min,largest:max" data-model="number">
                </p>

                <p>
                    <label for="data_min">Min number</label>
                    <input id="data_min" type="number" name="data_min" data-model="smallest">
                </p>
                <p>
                    <label for="data_max">Max number</label>
                    <input id="data_max" type="number" name="data_max" data-model="largest">
                </p>
            </article>
            <article>
                <h3>Data Views</h3>
                <dl>
                    <dt>Text</dt>
                    <dd data-watch="text"></dd>
                    <dd data-watch="favorites"></dd>

                    <dt>Numbers</dt>
                    <dd data-watch="number"></dd>
                    <dd data-watch="largest"></dd>
                    <dd data-watch="smallest"></dd>
                </dl>
            </article>
            <article>
                <h3>Inline Views</h3>
                <p>
                    I like <em data-watch="text"></em> and my favorites are <em data-watch="favorites"></em>
                </p>
                <p aria-live="polite" data-watch="name"></p>
            </article>
        </section>
    </main>
    <!-- JsUpdatr Setup -->
    <script type="module">
        import { watcher, observe } from './src/index.js'
        observe(document.state);
        const modelExist = model => document.state.hasOwnProperty(model);

        // Finding elements that will be used to control the data or "model"
        document.querySelectorAll('[data-model]').forEach(element => {
            element.value = document.state[element.dataset.model];
            element.addEventListener('input', () => {
                document.state[element.dataset.model] = element.value;
            });
        })

        // Finding elements that will be used to show the data or "view"
        document.querySelectorAll('[data-watch]').forEach(element => {
            if (modelExist(element.dataset.watch)) watcher.run(() => {
                element.textContent = document.state[element.dataset.watch];
            })
        })
        // Finding element attributes that will be set based on the model data
        // Example: data-watch-attributes="smallest:min,largest:max" 
        // Where max and min are the attributes and smallest anj largest are the models
        document.querySelectorAll('[data-watch-attributes]').forEach(element => {
            element.dataset.watchAttributes.split(',').forEach(attributesSet => {
                const [model, attribute] = attributesSet.split(':');
                if (modelExist(model) && attribute) {
                    watcher.run(() => {
                        element.setAttribute(attribute, document.state[model]);
                    })
                }
            });
        })
    </script>
</body>

</html>